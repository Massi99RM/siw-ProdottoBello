<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProdottoBello - Catalogo</title>
    <link rel="stylesheet" th:href="@{/stile.css}">
</head>
<body>
		<header>
		    <a href="/">Home</a> | 
		    <a href="/catalog">Catalogo</a> | 
		    <span th:if="${#authorization.expression('isAuthenticated()')}">
		        <a href="/profile">Profilo</a> |
		        <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
		            <a href="/admin">Admin</a> |
		        </span>
		        <a href="/logout">Logout (<span th:text="${#authentication.name}">username</span>)</a>
		    </span>
		    <span th:if="${#authorization.expression('isAnonymous()')}">
		        <a href="/login">Login</a> | 
		        <a href="/register">Registrati</a>
		    </span>
		</header>

    <main>
        <h1>Catalogo Prodotti</h1>
        
        <!-- Sezione Filtri e Ricerca -->
        <div class="filters-section">
            <div class="search-section">
                <h3>Cerca Prodotti</h3>
                <form method="get" action="/catalog" class="search-form">
                    <input type="text" name="search" th:value="${searchTerm}" placeholder="Cerca per nome..." class="search-input">
                    <input type="hidden" name="category" th:value="${selectedCategory}">
                    <input type="hidden" name="sort" th:value="${sortBy}">
                    <button type="submit" class="search-btn">Cerca</button>
                </form>
            </div>

            <div class="category-filters">
                <h3>Filtra per Categoria</h3>
                <div class="category-buttons">
                    <a th:href="@{/catalog(search=${searchTerm}, sort=${sortBy})}" 
                       th:class="${selectedCategory == null} ? 'category-btn active' : 'category-btn'">
                        Tutte le Categorie
                    </a>
                    <a th:href="@{/catalog(category='BOOKS', search=${searchTerm}, sort=${sortBy})}"
                       th:class="${selectedCategory == 'BOOKS'} ? 'category-btn active' : 'category-btn'">
                        Libri
                    </a>
                    <a th:href="@{/catalog(category='GARDEN', search=${searchTerm}, sort=${sortBy})}"
                       th:class="${selectedCategory == 'GARDEN'} ? 'category-btn active' : 'category-btn'">
                        Giardino
                    </a>
                    <a th:href="@{/catalog(category='ELECTRONICS', search=${searchTerm}, sort=${sortBy})}"
                       th:class="${selectedCategory == 'ELECTRONICS'} ? 'category-btn active' : 'category-btn'">
                        Elettronica
                    </a>
                    <a th:href="@{/catalog(category='CLOTHING', search=${searchTerm}, sort=${sortBy})}"
                       th:class="${selectedCategory == 'CLOTHING'} ? 'category-btn active' : 'category-btn'">
                        Abbigliamento
                    </a>
                    <a th:href="@{/catalog(category='OTHER', search=${searchTerm}, sort=${sortBy})}"
                       th:class="${selectedCategory == 'OTHER'} ? 'category-btn active' : 'category-btn'">
                        Altro
                    </a>
                </div>
            </div>

            <div class="sort-section">
                <h3>Ordina per</h3>
                <div class="sort-buttons">
                    <a th:href="@{/catalog(category=${selectedCategory}, search=${searchTerm}, sort='name')}"
                       th:class="${sortBy == 'name'} ? 'sort-btn active' : 'sort-btn'">
                        Nome A-Z
                    </a>
                    <a th:href="@{/catalog(category=${selectedCategory}, search=${searchTerm}, sort='price_asc')}"
                       th:class="${sortBy == 'price_asc'} ? 'sort-btn active' : 'sort-btn'">
                        Prezzo Crescente
                    </a>
                    <a th:href="@{/catalog(category=${selectedCategory}, search=${searchTerm}, sort='price_desc')}"
                       th:class="${sortBy == 'price_desc'} ? 'sort-btn active' : 'sort-btn'">
                        Prezzo Decrescente
                    </a>
                </div>
            </div>
        </div>

        <!-- Risultati -->
        <div class="results-section">
            <div class="results-header">
                <h2>
                    <span th:if="${selectedCategory != null}" th:text="'Categoria: ' + ${selectedCategory}">Categoria Selezionata</span>
                    <span th:if="${selectedCategory == null}">Tutti i Prodotti</span>
                    <span th:if="${searchTerm != null and !searchTerm.isEmpty()}" th:text="' - Ricerca: &quot;' + ${searchTerm} + '&quot;'"></span>
                </h2>
                <p class="results-count" th:text="'Trovati ' + ${products.size()} + ' prodotti'">Trovati X prodotti</p>
            </div>

            <!-- Lista Prodotti -->
            <div th:if="${products != null and !products.empty}" class="catalog-products">
                <div class="product-list">
                    <div class="product-card" th:each="product : ${products}">
                        <h3>
                            <a th:href="@{/product/{id}(id=${product.id})}" th:text="${product.name}">Nome Prodotto</a>
                        </h3>
                        <p class="product-type" th:text="${product.type}">Categoria</p>
                        <p class="product-price" th:text="'â‚¬ ' + ${product.price}">Prezzo</p>
                        <p class="product-description" th:text="${#strings.abbreviate(product.description, 100)}">Descrizione breve...</p>
                        <a th:href="@{/product/{id}(id=${product.id})}" class="view-details">Vedi dettagli</a>
                    </div>
                </div>
            </div>

            <!-- Nessun Risultato -->
            <div th:if="${products == null or products.empty}" class="no-results">
                <h3>Nessun prodotto trovato</h3>
                <p th:if="${searchTerm != null and !searchTerm.isEmpty()}">
                    Prova a modificare i termini di ricerca o rimuovere i filtri.
                </p>
                <p th:if="${selectedCategory != null}">
                    Non ci sono prodotti in questa categoria al momento.
                </p>
                <a href="/catalog" class="reset-filters">Rimuovi tutti i filtri</a>
            </div>
        </div>
    </main>
</body>
</html>